<template>
    <lightning-card title="Enterprise Analytics Dashboard" icon-name="standard:dashboard">
        <!-- Dashboard Header with Refresh and Settings -->
        <div slot="actions">
            <lightning-button-group>
                <lightning-button 
                    variant="neutral" 
                    label="Refresh" 
                    icon-name="utility:refresh"
                    onclick={handleRefresh}
                    disabled={isLoading}>
                </lightning-button>
                <lightning-button 
                    variant="neutral" 
                    label="Settings" 
                    icon-name="utility:settings"
                    onclick={handleSettings}>
                </lightning-button>
            </lightning-button-group>
        </div>

        <!-- Loading Spinner -->
        <template if:true={isLoading}>
            <div class="slds-is-relative slds-p-around_large">
                <lightning-spinner alternative-text="Loading dashboard data..." size="medium"></lightning-spinner>
            </div>
        </template>

        <!-- Error Message -->
        <template if:true={error}>
            <div class="slds-p-around_medium">
                <div class="slds-notify slds-notify_alert slds-alert_error" role="alert">
                    <span class="slds-assistive-text">Error</span>
                    <h2>
                        <lightning-icon icon-name="utility:error" size="x-small" class="slds-m-right_x-small"></lightning-icon>
                        Error loading dashboard data: {error}
                    </h2>
                </div>
            </div>
        </template>

        <!-- Dashboard Content -->
        <template if:false={isLoading}>
            <template if:false={error}>
                <!-- Dashboard Navigation Tabs -->
                <lightning-tabset variant="standard" active-tab-value={activeTab} onactive={handleTabChange}>
                    
                    <!-- Executive Summary Tab -->
                    <lightning-tab label="Executive Summary" value="executive" icon-name="standard:dashboard">
                        <div class="slds-p-around_medium">
                            <c-executive-summary-dashboard 
                                dashboard-data={dashboardData}
                                performance-metrics={performanceMetrics}
                                onrefresh={handleChildRefresh}>
                            </c-executive-summary-dashboard>
                        </div>
                    </lightning-tab>

                    <!-- Order Analytics Tab -->
                    <lightning-tab label="Order Analytics" value="orders" icon-name="standard:orders">
                        <div class="slds-p-around_medium">
                            <c-order-analytics-dashboard 
                                dashboard-data={dashboardData}
                                recent-orders={recentOrders}
                                onrefresh={handleChildRefresh}>
                            </c-order-analytics-dashboard>
                        </div>
                    </lightning-tab>

                    <!-- Inventory Management Tab -->
                    <lightning-tab label="Inventory" value="inventory" icon-name="standard:product">
                        <div class="slds-p-around_medium">
                            <c-inventory-dashboard 
                                inventory-data={inventoryData}
                                dashboard-data={dashboardData}
                                onrefresh={handleChildRefresh}>
                            </c-inventory-dashboard>
                        </div>
                    </lightning-tab>

                    <!-- Customer Analytics Tab -->
                    <lightning-tab label="Customers" value="customers" icon-name="standard:account">
                        <div class="slds-p-around_medium">
                            <c-customer-dashboard 
                                customer-analytics={customerAnalytics}
                                dashboard-data={dashboardData}
                                onrefresh={handleChildRefresh}>
                            </c-customer-dashboard>
                        </div>
                    </lightning-tab>

                    <!-- Performance Monitoring Tab -->
                    <lightning-tab label="Performance" value="performance" icon-name="standard:metrics">
                        <div class="slds-p-around_medium">
                            <c-performance-dashboard 
                                performance-metrics={performanceMetrics}
                                onrefresh={handleChildRefresh}>
                            </c-performance-dashboard>
                        </div>
                    </lightning-tab>

                </lightning-tabset>

                <!-- Dashboard Footer with Last Updated Info -->
                <div class="slds-p-around_small slds-border_top">
                    <div class="slds-grid slds-grid_align-spread slds-text-body_small slds-text-color_weak">
                        <div>
                            <lightning-icon icon-name="utility:clock" size="xx-small" class="slds-m-right_xx-small"></lightning-icon>
                            Last updated: {lastUpdated}
                        </div>
                        <div>
                            <lightning-icon icon-name="utility:database" size="xx-small" class="slds-m-right_xx-small"></lightning-icon>
                            Data points: {totalDataPoints}
                        </div>
                        <div>
                            <lightning-icon icon-name="utility:speed" size="xx-small" class="slds-m-right_xx-small"></lightning-icon>
                            Load time: {loadTime}ms
                        </div>
                    </div>
                </div>
            </template>
        </template>

        <!-- Settings Modal -->
        <template if:true={showSettings}>
            <section role="dialog" tabindex="-1" class="slds-modal slds-fade-in-open">
                <div class="slds-modal__container">
                    <header class="slds-modal__header">
                        <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" 
                                title="Close" onclick={handleCloseSettings}>
                            <lightning-icon icon-name="utility:close" size="small"></lightning-icon>
                            <span class="slds-assistive-text">Close</span>
                        </button>
                        <h2 class="slds-text-heading_medium slds-hyphenate">Dashboard Settings</h2>
                    </header>
                    <div class="slds-modal__content slds-p-around_medium">
                        <div class="slds-form-element">
                            <label class="slds-form-element__label" for="refresh-interval">Auto Refresh Interval</label>
                            <div class="slds-form-element__control">
                                <lightning-combobox
                                    name="refreshInterval"
                                    value={refreshInterval}
                                    placeholder="Select refresh interval"
                                    options={refreshIntervalOptions}
                                    onchange={handleRefreshIntervalChange}>
                                </lightning-combobox>
                            </div>
                        </div>
                        <div class="slds-form-element slds-m-top_medium">
                            <lightning-input 
                                type="checkbox" 
                                label="Enable Real-time Updates" 
                                checked={enableRealTimeUpdates}
                                onchange={handleRealTimeToggle}>
                            </lightning-input>
                        </div>
                        <div class="slds-form-element slds-m-top_medium">
                            <lightning-input 
                                type="checkbox" 
                                label="Show Performance Metrics" 
                                checked={showPerformanceMetrics}
                                onchange={handlePerformanceToggle}>
                            </lightning-input>
                        </div>
                    </div>
                    <footer class="slds-modal__footer">
                        <lightning-button variant="neutral" label="Cancel" onclick={handleCloseSettings}></lightning-button>
                        <lightning-button variant="brand" label="Save Settings" onclick={handleSaveSettings}></lightning-button>
                    </footer>
                </div>
            </section>
            <div class="slds-backdrop slds-backdrop_open"></div>
        </template>

    </lightning-card>
</template>
